class AuthSystem{constructor(){this.SESSION_KEY="framex_admin_session",this.REMEMBER_KEY="framex_admin_remember",this.SESSION_TIMEOUT=18e5,this.REMEMBER_DURATION=2592e6,this.DEFAULT_CREDENTIALS={username:"admin",password:"framex2024"},this.lastActivity=Date.now(),this.activityCheckInterval=null,this.init()}init(){this.checkRememberedLogin(),this.isAuthenticated()&&this.startActivityMonitoring(),["mousedown","keydown","scroll","touchstart"].forEach(t=>{document.addEventListener(t,()=>{this.updateActivity()},{passive:!0})})}async login(t,e,i=!1){try{if(this.validateCredentials(t,e)){const s={username:t,loginTime:Date.now(),lastActivity:Date.now(),isAdmin:!0};if(sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(s)),i){const e={username:t,token:this.generateToken(),expiry:Date.now()+this.REMEMBER_DURATION};localStorage.setItem(this.REMEMBER_KEY,JSON.stringify(e))}return this.startActivityMonitoring(),this.logActivity("login",{username:t}),{success:!0,message:"Đăng nhập thành công"}}return this.logActivity("login_failed",{username:t}),{success:!1,message:"Tên đăng nhập hoặc mật khẩu không đúng"}}catch(t){return console.error("Login error:",t),{success:!1,message:"Lỗi đăng nhập. Vui lòng thử lại."}}}validateCredentials(t,e){return t===this.DEFAULT_CREDENTIALS.username&&e===this.DEFAULT_CREDENTIALS.password}isAuthenticated(){const t=this.getSessionData();if(!t)return!1;if(Date.now()-t.lastActivity>this.SESSION_TIMEOUT)return this.logout(!1),!1;return!0}getSessionData(){try{const t=sessionStorage.getItem(this.SESSION_KEY);return t?JSON.parse(t):null}catch(t){return console.error("Error getting session data:",t),null}}updateActivity(){if(!this.isAuthenticated())return;const t=this.getSessionData();t&&(t.lastActivity=Date.now(),sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(t)),this.lastActivity=Date.now())}startActivityMonitoring(){this.activityCheckInterval&&clearInterval(this.activityCheckInterval),this.activityCheckInterval=setInterval(()=>{this.isAuthenticated()||this.handleSessionTimeout()},6e4)}handleSessionTimeout(){clearInterval(this.activityCheckInterval),alert("Phiên làm việc đã hết hạn do không có hoạt động. Vui lòng đăng nhập lại."),window.location.href="admin-login.html"}checkRememberedLogin(){try{const t=localStorage.getItem(this.REMEMBER_KEY);if(!t)return;const e=JSON.parse(t),i=Date.now();if(e.expiry>i){const t={username:e.username,loginTime:i,lastActivity:i,isAdmin:!0,remembered:!0};sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(t))}else localStorage.removeItem(this.REMEMBER_KEY)}catch(t){console.error("Error checking remembered login:",t),localStorage.removeItem(this.REMEMBER_KEY)}}isRemembered(){return null!==localStorage.getItem(this.REMEMBER_KEY)}logout(t=!0){sessionStorage.removeItem(this.SESSION_KEY),localStorage.removeItem(this.REMEMBER_KEY),this.activityCheckInterval&&clearInterval(this.activityCheckInterval),this.logActivity("logout"),t&&(window.location.href="admin-login.html")}forceLogout(){sessionStorage.removeItem(this.SESSION_KEY),localStorage.removeItem(this.REMEMBER_KEY),this.activityCheckInterval&&clearInterval(this.activityCheckInterval),window.location.href="admin-login.html"}getCurrentUser(){const t=this.getSessionData();return t?{username:t.username,loginTime:t.loginTime,isAdmin:t.isAdmin}:null}generateToken(){return Math.random().toString(36).substring(2)+Date.now().toString(36)+Math.random().toString(36).substring(2)}logActivity(t,e={}){const i={timestamp:(new Date).toISOString(),action:t,username:this.getCurrentUser()?.username||"unknown",...e},s=this.getActivityLogs();s.unshift(i),s.length>100&&s.splice(100),localStorage.setItem("framex_activity_logs",JSON.stringify(s))}getActivityLogs(){try{const t=localStorage.getItem("framex_activity_logs");return t?JSON.parse(t):[]}catch(t){return[]}}isSecureConnection(){return"https:"===window.location.protocol||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname}getSecurityRecommendations(){const t=[];return this.isSecureConnection()||t.push({level:"critical",message:"Bật HTTPS để bảo vệ mật khẩu và dữ liệu",icon:"fa-exclamation-triangle"}),"framex2024"===this.DEFAULT_CREDENTIALS.password&&t.push({level:"high",message:"Đổi mật khẩu mặc định ngay lập tức",icon:"fa-key"}),t.push({level:"medium",message:"Backup database định kỳ (mỗi tuần)",icon:"fa-database"}),t.push({level:"low",message:"Kiểm tra activity logs thường xuyên",icon:"fa-history"}),t}changePassword(t,e){return{success:!1,message:"Tính năng đổi mật khẩu cần kết nối với backend. Vui lòng liên hệ quản trị viên."}}}const Auth=new AuthSystem;"undefined"!=typeof module&&module.exports&&(module.exports=Auth);